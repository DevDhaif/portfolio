/* src/styles/tiptap-styles.css */
/* 
 * TipTap Editor Styles
 * Synced between Editor and ContentRenderer
 */

@tailwind base;
@tailwind components;
@tailwind utilities;

/* ============================================
   CSS Custom Properties
   ============================================ */
:root {
  /* Editor colors */
  --editor-bg: theme('colors.gray.900');
  --editor-text: theme('colors.gray.200');
  --editor-text-muted: theme('colors.gray.400');
  --editor-border: theme('colors.gray.800');
  --editor-accent: theme('colors.blue.500');

  /* Code block */
  --code-bg: #282c34;
  --code-text: #abb2bf;

  /* Lists */
  --list-marker-color: theme('colors.gray.500');
  --list-indent: 1.5rem;
}

/* ============================================
   Animations
   ============================================ */
@keyframes fadeIn {
  from {
    opacity: 0;
    transform: translateY(-4px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

@keyframes fadeOut {
  from {
    opacity: 1;
  }
  to {
    opacity: 0;
  }
}

.animate-fade-in {
  animation: fadeIn 0.2s ease-out;
}

.animate-fade-out {
  animation: fadeOut 0.2s ease-out forwards;
}

/* ============================================
   Base Content Styles (Shared)
   ============================================ */
@layer components {
  .tiptap-content {
    @apply max-w-none text-gray-200 leading-relaxed;

    /* Headings */
    & h1 {
      @apply text-3xl font-bold mb-6 text-gray-50 border-b border-gray-800/50 pb-2 mt-8 first:mt-0;
    }

    & h2 {
      @apply text-2xl font-bold mb-4 text-gray-100 mt-8 first:mt-0;
    }

    & h3 {
      @apply text-xl font-bold mb-3 text-gray-200 mt-6 first:mt-0;
    }

    /* Paragraphs */
    & p {
      @apply mb-4 leading-relaxed text-base text-gray-200;
      line-height: 1.75;
    }

    & p:empty,
    & p.is-empty {
      min-height: 1.5em;
    }

    /* =====================================
           List Styles - Properly Nested
           ===================================== */

    /* Base bullet list */
    & ul {
      @apply pl-6 mb-4 space-y-1;
      list-style-type: disc;
    }

    /* Base ordered list */
    & ol {
      @apply pl-6 mb-4 space-y-1;
      list-style-type: decimal;
    }

    /* List items */
    & li {
      @apply text-gray-200 pl-1;
    }

    & li > p {
      @apply mb-1;
    }

    & li > p:last-child {
      @apply mb-0;
    }

    /* Nested lists - Level 2 */
    & ul ul,
    & ol ul {
      @apply mt-2 mb-1 ml-2;
      list-style-type: circle;
    }

    & ul ol,
    & ol ol {
      @apply mt-2 mb-1 ml-2;
      list-style-type: lower-alpha;
    }

    /* Nested lists - Level 3 */
    & ul ul ul,
    & ol ul ul,
    & ul ol ul,
    & ol ol ul {
      @apply mt-1 mb-1;
      list-style-type: square;
    }

    & ul ul ol,
    & ol ul ol,
    & ul ol ol,
    & ol ol ol {
      @apply mt-1 mb-1;
      list-style-type: lower-roman;
    }

    /* Nested lists - Level 4 */
    & ul ul ul ul,
    & ol ol ol ol {
      list-style-type: disc;
    }

    /* Nested list spacing */
    & li > ul,
    & li > ol {
      @apply mt-1 mb-0;
    }

    /* RTL List Support */
    & ul[dir='rtl'],
    & ol[dir='rtl'] {
      @apply pr-6 pl-0;
      direction: rtl;
    }

    & li[dir='rtl'] {
      @apply pr-1 pl-0 text-right;
    }

    /* =====================================
           Other Block Elements
           ===================================== */

    /* Blockquote */
    & blockquote {
      @apply border-l-4 border-blue-500/50 bg-blue-900/10 pl-6 py-3 pr-4 italic my-6 rounded-r-lg;
    }

    & blockquote p:last-child {
      @apply mb-0;
    }

    /* Horizontal rule */
    & hr {
      @apply border-gray-700 my-8;
    }

    /* Links */
    & a {
      @apply text-blue-400 hover:text-blue-300 underline decoration-blue-500/30 hover:decoration-blue-400 transition-all duration-200;
      text-underline-offset: 2px;
    }

    /* Code blocks */
    & pre {
      @apply bg-[#282c34] text-white p-4 rounded-lg my-6 overflow-x-auto border border-gray-800 relative;
      font-family: 'JetBrains Mono', 'Fira Code', monospace;
      font-size: 0.875rem;
      line-height: 1.6;
      tab-size: 2;
    }

    & pre code {
      @apply bg-transparent p-0 text-inherit;
      font-family: inherit;
    }

    /* Inline code */
    & :not(pre) > code {
      @apply bg-gray-800 text-gray-200 px-1.5 py-0.5 rounded text-sm font-mono;
    }

    /* Images */
    & img {
      @apply rounded-lg max-w-full my-6 mx-auto block;
    }

    /* Tables */
    & table {
      @apply w-full my-6 border-collapse overflow-hidden rounded-lg border border-gray-800;
    }

    & table th {
      @apply bg-gray-800 text-gray-200 p-3 text-left font-medium;
    }

    & table td {
      @apply border-t border-gray-800 p-3;
    }

    /* Text direction */
    &[dir='rtl'] {
      @apply text-right;
      direction: rtl;
    }

    &[dir='ltr'] {
      @apply text-left;
      direction: ltr;
    }

    /* Strikethrough */
    & s,
    & del,
    & strike {
      @apply line-through text-gray-400;
    }

    /* Strong/Bold */
    & strong {
      @apply font-bold text-gray-100;
    }

    /* Emphasis/Italic */
    & em {
      @apply italic;
    }
  }

  /* ============================================
       Editor-Specific Styles
       ============================================ */
  .tiptap-editor {
    @apply outline-none min-h-[400px];

    & .ProseMirror {
      @apply text-gray-200 min-h-[400px] max-w-none outline-none;
    }

    & .ProseMirror-focused {
      @apply outline-none;
    }

    /* Selected node */
    & .ProseMirror-selectednode {
      @apply outline-2 outline-blue-500 outline-offset-2;
    }

    /* Drop cursor */
    & .ProseMirror-dropcursor {
      @apply bg-blue-500/50;
      width: 2px;
    }

    /* Placeholder */
    & p.is-editor-empty:first-child::before {
      @apply text-gray-500 pointer-events-none float-left h-0;
      content: attr(data-placeholder);
    }

    /* Image states */
    & img {
      @apply border-2 border-transparent cursor-pointer transition-all;

      &:hover {
        @apply border-blue-500/50;
      }

      &.ProseMirror-selectednode {
        @apply border-blue-500 ring-2 ring-blue-500/30;
      }
    }
  }

  /* ============================================
       Content Reader Specific Styles
       ============================================ */
  .content-reader {
    @apply max-w-none text-gray-300;

    & img {
      @apply border border-gray-800/30 shadow-lg transition-transform duration-200;

      &:hover {
        transform: scale(1.01);
      }
    }

    & pre {
      @apply shadow-lg;
    }

    /* Code block language label */
    & pre[data-language]::before {
      content: attr(data-language);
      @apply absolute right-12 top-2 text-xs px-2 py-1 rounded bg-gray-800/80 text-gray-400 uppercase tracking-wide;
    }

    & a {
      @apply relative;

      &::after {
        content: '';
        @apply absolute bottom-0 left-0 w-full h-0.5 bg-blue-500/0 transition-all;
      }

      &:hover::after {
        @apply bg-blue-500/30;
      }
    }

    & blockquote {
      @apply rounded-r-lg shadow-sm;
    }
  }

  /* ============================================
       Toolbar Styles
       ============================================ */
  .editor-toolbar {
    @apply flex flex-wrap items-center gap-1 p-2 bg-gray-900 border-b border-gray-800 sticky top-0 z-10;
  }

  .editor-toolbar-button {
    @apply p-2 rounded-md text-gray-400 hover:bg-gray-800 hover:text-gray-100 transition-colors;

    &.is-active {
      @apply bg-blue-500/20 text-blue-300;
    }

    &:disabled {
      @apply opacity-40 cursor-not-allowed hover:bg-transparent hover:text-gray-400;
    }

    &:focus-visible {
      @apply outline-none ring-2 ring-blue-500 ring-offset-2 ring-offset-gray-900;
    }
  }

  /* ============================================
       Footer Styles
       ============================================ */
  .editor-footer {
    @apply flex items-center justify-between px-4 py-2 bg-gray-900/50 border-t border-gray-800 text-xs text-gray-500;
  }
}

/* ============================================
   Scrollbar Styles
   ============================================ */
.tiptap-content ::-webkit-scrollbar,
.tiptap-editor ::-webkit-scrollbar {
  width: 8px;
  height: 8px;
}

.tiptap-content ::-webkit-scrollbar-track,
.tiptap-editor ::-webkit-scrollbar-track {
  @apply bg-gray-900;
}

.tiptap-content ::-webkit-scrollbar-thumb,
.tiptap-editor ::-webkit-scrollbar-thumb {
  @apply rounded-full bg-gray-700 hover:bg-gray-600;
}

/* ============================================
   Selection Styles
   ============================================ */
.tiptap-content ::selection,
.tiptap-editor ::selection {
  @apply bg-blue-900/40 text-white;
}

/* ============================================
   Print Styles
   ============================================ */
@media print {
  .editor-toolbar,
  .editor-footer {
    display: none !important;
  }

  .tiptap-content {
    color: black !important;
    background: white !important;
  }

  .tiptap-content pre {
    border: 1px solid #ccc !important;
    background: #f5f5f5 !important;
    color: #333 !important;
  }

  .tiptap-content a {
    color: #0066cc !important;
  }
}

/* ============================================
   Focus Styles for Accessibility
   ============================================ */
.editor-container:focus-within {
  @apply ring-2 ring-blue-500/50 ring-offset-2 ring-offset-gray-900 rounded-lg;
}

/* ============================================
   Copy Button Toast Animation
   ============================================ */
.copy-notification {
  @apply absolute right-2 top-2 bg-green-500/90 text-white px-2 py-1 rounded text-xs shadow-lg;
  animation: fadeInOut 2s forwards;
}

@keyframes fadeInOut {
  0% {
    opacity: 0;
    transform: translateY(-4px);
  }
  15% {
    opacity: 1;
    transform: translateY(0);
  }
  85% {
    opacity: 1;
  }
  100% {
    opacity: 0;
  }
}
